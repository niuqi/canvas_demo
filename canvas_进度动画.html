<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
		<title>进度条</title>
		<style>
			*{padding:0;margin:0;box-sizing: border-box;}
			html,body{width:100vw;height:100vh;}
		</style>
	</head>
	<body>
		<script type="text/javascript">
			function canvasLoading(){
				this.init();
			}
			canvasLoading.prototype.init = function(){
				if(!document.getElementById("canvasLoading")){
					this.c = document.createElement("canvas");
					this.ctx = this.c.getContext("2d");
					this.c.setAttribute("id","canvas");
					document.body.appendChild(this.c);
					this.c.width = 100;
					this.c.height = 100;
					this.c.style.position = "fixed";
					this.c.style.top = "50%";
					this.c.style.left = "50%";
					this.c.style.marginTop = -this.c.height/2 + "px";
					this.c.style.marginLeft = -this.c.width/2 + "px";
					this.c.style.backgroundColor = "#eee";
					this.c.style.borderRadius = "4px";
					/*线条基础坐标点*/
					this.lineX = 5;
					this.lineY = 8;
					/*矩形基础坐标点*/
					this.rectX = 0;
					this.rectY = 0;
					/*动画节点时间标记*/
					this.timeMarkIn = null;
					this.timeMarkOut = null;
				}
				this.move();
			}
			canvasLoading.prototype.creatLine = function(){
				var _this = this;
				_this.ctx.beginPath();
				_this.ctx.strokeStyle = "#888";
				_this.ctx.moveTo(_this.lineX,_this.lineY);
				_this.ctx.lineTo(_this.lineX+90,_this.lineY);
				_this.ctx.stroke();
				_this.ctx.closePath();
				_this.lineY += 12;
				_this.ctx.closePath();
			}
			canvasLoading.prototype.creatRect = function(){
				var _this = this;
				_this.ctx.beginPath();
				_this.ctx.fillStyle = "#eee";
				_this.ctx.fillRect(_this.rectX,_this.rectY,50,50);
				_this.ctx.closePath();
				_this.ctx.beginPath();
				_this.ctx.strokeStyle = "#999";
				_this.ctx.rect(_this.rectX+8,_this.rectY+8,35,35);
				_this.ctx.stroke();
				_this.ctx.closePath();
			}
			canvasLoading.prototype.creatText = function(){
				var _this = this;
				_this.ctx.beginPath();
				_this.ctx.font = "8px 微软雅黑   normal";
				_this.ctx.fillStyle = "#333";
				_this.ctx.textAlign = "left";
				_this.ctx.textBaseline = "middle";
				_this.ctx.fillText("用数据改变世界。",10,(_this.c.height/2-12));
				_this.ctx.closePath();
			}
			canvasLoading.prototype.move = function(){
				var _this = this;
				/*清空画布 */
				_this.ctx.clearRect(0,0,_this.c.width,_this.c.height);
				_this.lineX = 5;
				_this.lineY = 8;
				/*创建线条*/
				for(var i=0;i<=8;i++ ){
					_this.creatLine();
				}
				/*创建文字*/
				_this.creatText();
				/*创建矩形*/
				_this.creatRect();
				
				if((_this.rectX==0 && _this.rectY==0) 
				|| (_this.rectX==50 && _this.rectY==0)
				|| (_this.rectX==50 && _this.rectY==50)
				|| (_this.rectX==0 && _this.rectY==50)
				){
					if(!_this.timeMarkIn){
						_this.timeMarkIn = new Date();
						_this.timeMarkIn = _this.timeMarkIn.getTime();
					}
					_this.timeMarkOut = new Date();
					_this.timeMarkOut = _this.timeMarkOut.getTime();	
					if(_this.timeMarkOut-_this.timeMarkIn<=300){
						_this.requestAnimationFrame(function(){_this.move()});
						return;
					}else{
						_this.timeMarkIn = null;
						_this.timeMarkOut = null;
					}
				}
				if(_this.rectX<50 && _this.rectY==0){
					_this.rectX+=5;
				}else if(_this.rectX==50 && _this.rectY<50){
					_this.rectY+=5;
				}else if(_this.rectX>0 && _this.rectY==50){
					_this.rectX-=5;
				}else if(_this.rectX==0 && _this.rectY>0){
					_this.rectY-=5;
				}
				_this.requestAnimationFrame(function(){_this.move()});
			}
			canvasLoading.prototype.requestAnimationFrame = function(callback){
				if(window.requestAnimationFrame){
					window.requestAnimationFrame(callback);
				}else if(window.webkitRequestAnimationFrame){
					window.webkitRequestAnimationFrame(callback);
				}else if(window.mozRequestAnimationFrame){
					window.mozRequestAnimationFrame(callback);
				}else{
					setTimeout(callback,1000/60);
				}
			}
			window.onload = function(){
				new canvasLoading();
			}
		</script>
	</body>
</html>
